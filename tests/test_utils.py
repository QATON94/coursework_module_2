from pathlib import Path

from src.utils import get_transactions, get_user_settings

ROOT_PATH = Path(__file__).parent.parent
def test_get_transactions():
    TEST_OPERATIONS_JSON = ROOT_PATH.joinpath("tests", 'test_operations.xls')
    assert get_transactions(TEST_OPERATIONS_JSON) == [{'MCC': 5411,
  'Бонусы (включая кэшбэк)': 3,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '31.12.2021 16:44:00',
  'Дата платежа': '31.12.2021',
  'Категория': 'Супермаркеты',
  'Кэшбэк': 0,
  'Номер карты': '*7197',
  'Округление на инвесткопилку': 0,
  'Описание': 'Колхоз',
  'Статус': 'OK',
  'Сумма операции': -160.89,
  'Сумма операции с округлением': 160.89,
  'Сумма платежа': -160.89},
 {'MCC': 5411,
  'Бонусы (включая кэшбэк)': 1,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '31.12.2021 16:42:04',
  'Дата платежа': '31.12.2021',
  'Категория': 'Супермаркеты',
  'Кэшбэк': 0,
  'Номер карты': '*7197',
  'Округление на инвесткопилку': 0,
  'Описание': 'Колхоз',
  'Статус': 'OK',
  'Сумма операции': -64.0,
  'Сумма операции с округлением': 64.0,
  'Сумма платежа': -64.0},
 {'MCC': 5411,
  'Бонусы (включая кэшбэк)': 2,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '31.12.2021 16:39:04',
  'Дата платежа': '31.12.2021',
  'Категория': 'Супермаркеты',
  'Кэшбэк': 0,
  'Номер карты': '*7197',
  'Округление на инвесткопилку': 0,
  'Описание': 'Магнит',
  'Статус': 'OK',
  'Сумма операции': -118.12,
  'Сумма операции с округлением': 118.12,
  'Сумма платежа': -118.12},
 {'MCC': 5411,
  'Бонусы (включая кэшбэк)': 1,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '31.12.2021 15:44:39',
  'Дата платежа': '31.12.2021',
  'Категория': 'Супермаркеты',
  'Кэшбэк': 0,
  'Номер карты': '*7197',
  'Округление на инвесткопилку': 0,
  'Описание': 'Колхоз',
  'Статус': 'OK',
  'Сумма операции': -78.05,
  'Сумма операции с округлением': 78.05,
  'Сумма платежа': -78.05},
 {'MCC': 5399,
  'Бонусы (включая кэшбэк)': 5,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '31.12.2021 01:23:42',
  'Дата платежа': '31.12.2021',
  'Категория': 'Различные товары',
  'Кэшбэк': 0,
  'Номер карты': '*5091',
  'Округление на инвесткопилку': 0,
  'Описание': 'Ozon.ru',
  'Статус': 'OK',
  'Сумма операции': -564.0,
  'Сумма операции с округлением': 564.0,
  'Сумма платежа': -564.0},
 {'MCC': 0,
  'Бонусы (включая кэшбэк)': 0,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '31.12.2021 00:12:53',
  'Дата платежа': '31.12.2021',
  'Категория': 'Переводы',
  'Кэшбэк': 0,
  'Номер карты': 0,
  'Округление на инвесткопилку': 0,
  'Описание': 'Константин Л.',
  'Статус': 'OK',
  'Сумма операции': -800.0,
  'Сумма операции с округлением': 800.0,
  'Сумма платежа': -800.0},
 {'MCC': 0,
  'Бонусы (включая кэшбэк)': 0,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '30.12.2021 22:22:03',
  'Дата платежа': '31.12.2021',
  'Категория': 'Переводы',
  'Кэшбэк': 0,
  'Номер карты': 0,
  'Округление на инвесткопилку': 0,
  'Описание': 'Константин Л.',
  'Статус': 'OK',
  'Сумма операции': -20000.0,
  'Сумма операции с округлением': 20000.0,
  'Сумма платежа': -20000.0},
 {'MCC': 7512,
  'Бонусы (включая кэшбэк)': 0,
  'Валюта операции': 'RUB',
  'Валюта платежа': 'RUB',
  'Дата операции': '30.12.2021 19:18:22',
  'Дата платежа': '31.12.2021',
  'Категория': 'Каршеринг',
  'Кэшбэк': 0,
  'Номер карты': '*5091',
  'Округление на инвесткопилку': 0,
  'Описание': 'Ситидрайв',
  'Статус': 'OK',
  'Сумма операции': -7.07,
  'Сумма операции с округлением': 7.07,
  'Сумма платежа': -7.07}]

def test_get_transactions_no_file():
    assert get_transactions('test_operations1.xls') == []


def test_get_user_settings():
    TEST_USER_SETTINGS = ROOT_PATH.joinpath("tests", 'test_user_settings.json')
    assert get_user_settings(TEST_USER_SETTINGS) == {'user_currencies': ['USD'], 'user_stocks': ['SOXS', 'TSLA']}